<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>User-Managed Access (UMA) Profile of OAuth 2.0</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions"/>
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology"/>
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 APIs and Protection"/>
<link href="#rfc.section.1.3.1" rel="Chapter" title="1.3.1 Protection and Authorization APIs at the Authorization Server"/>
<link href="#rfc.section.1.3.2" rel="Chapter" title="1.3.2 API at the Resource Server"/>
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 Authorization Server Configuration Data"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Protecting a Resource"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Getting Authorization and Accessing a Resource"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Client Attempts to Access Protected Resource"/>
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Client Presents No RPT"/>
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Client Presents RPT"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Resource Server Registers Requested Permission With Authorization Server"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Resource Server Determines RPT's Status"/>
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 Token Introspection"/>
<link href="#rfc.section.3.3.2" rel="Chapter" title="3.3.2 RPT Profile: Bearer"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Client Seeks Authorization for Access"/>
<link href="#rfc.section.3.4.1" rel="Chapter" title="3.4.1 Client Obtains RPT"/>
<link href="#rfc.section.3.4.2" rel="Chapter" title="3.4.2 Client Asks for Authorization Data"/>
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Claims-Gathering Flows"/>
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 Claims-Gathering Flow for Clients Operated by End-Users"/>
<link href="#rfc.section.3.5.1.1" rel="Chapter" title="3.5.1.1 OpenID Connect Claim Profile"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Error Messages"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 OAuth Error Responses"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 UMA Error Responses"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Specificying Additional Profiles"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Specifying Profiles of UMA"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Specifying RPT Profiles"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Specifying Claim Profiles"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Privacy Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Conformance"/>
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgments"/>
<link href="#rfc.section.11" rel="Chapter" title="11 Issues"/>
<link href="#rfc.references" rel="Chapter" title="12 References"/>
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Document History"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Hardjono, T., Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-hardjono-oauth-umacore-07d" />
  <meta name="dct.issued" scheme="ISO8601" content="2013-6-27" />
  <meta name="dct.abstract" content="User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy." />
  <meta name="description" content="User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">T. Hardjono, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">MIT</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">June 27, 2013</td>
</tr>
<tr>
  <td class="left">Expires: December 29, 2013</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">User-Managed Access (UMA) Profile of OAuth 2.0<br />
  <span class="filename">draft-hardjono-oauth-umacore-07d</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 29, 2013.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2013 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a></li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a></li>
<li>1.3.   <a href="#rfc.section.1.3">APIs and Protection</a></li>
<li>1.3.1.   <a href="#rfc.section.1.3.1">Protection and Authorization APIs at the Authorization Server</a></li>
<li>1.3.2.   <a href="#rfc.section.1.3.2">API at the Resource Server</a></li>
<li>1.4.   <a href="#rfc.section.1.4">Authorization Server Configuration Data</a></li>
<li>2.   <a href="#rfc.section.2">Protecting a Resource</a></li>
<li>3.   <a href="#rfc.section.3">Getting Authorization and Accessing a Resource</a></li>
<li>3.1.   <a href="#rfc.section.3.1">Client Attempts to Access Protected Resource</a></li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">Client Presents No RPT</a></li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Client Presents RPT</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Resource Server Registers Requested Permission With Authorization Server</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Resource Server Determines RPT's Status</a></li>
<li>3.3.1.   <a href="#rfc.section.3.3.1">Token Introspection</a></li>
<li>3.3.2.   <a href="#rfc.section.3.3.2">RPT Profile: Bearer</a></li>
<li>3.4.   <a href="#rfc.section.3.4">Client Seeks Authorization for Access</a></li>
<li>3.4.1.   <a href="#rfc.section.3.4.1">Client Obtains RPT</a></li>
<li>3.4.2.   <a href="#rfc.section.3.4.2">Client Asks for Authorization Data</a></li>
<li>3.5.   <a href="#rfc.section.3.5">Claims-Gathering Flows</a></li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">Claims-Gathering Flow for Clients Operated by End-Users</a></li>
<li>3.5.1.1.   <a href="#rfc.section.3.5.1.1">OpenID Connect Claim Profile</a></li>
<li>4.   <a href="#rfc.section.4">Error Messages</a></li>
<li>4.1.   <a href="#rfc.section.4.1">OAuth Error Responses</a></li>
<li>4.2.   <a href="#rfc.section.4.2">UMA Error Responses</a></li>
<li>5.   <a href="#rfc.section.5">Specificying Additional Profiles</a></li>
<li>5.1.   <a href="#rfc.section.5.1">Specifying Profiles of UMA</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Specifying RPT Profiles</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Specifying Claim Profiles</a></li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Privacy Considerations</a></li>
<li>8.   <a href="#rfc.section.8">Conformance</a></li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Acknowledgments</a></li>
<li>11.   <a href="#rfc.section.11">Issues</a></li>
<li>12.   <a href="#rfc.references">References</a></li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Document History</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">User-Managed Access (UMA) is a profile of OAuth 2.0 <a href="#OAuth2">[OAuth2]</a>. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policy. Resource owners configure authorization servers with access policies that serve as implicit authorization grants. Thus, the UMA profile of OAuth can be considered to encompass an authorization grant flow.</p>
<p id="rfc.section.1.p.2">UMA serves numerous use cases where a resource owner outsources authorization for access to their resources, potentially even without the run-time presence of the resource owner. A typical example is the following: a web user (an end-user resource owner) can authorize a web app (client) to gain one-time or ongoing access to a protected resource containing his home address stored at a "personal data store" service (resource server), by telling the resource server to respect access entitlements issued by his chosen cloud-based authorization service (authorization server). The requesting party operating the client might be the resource owner himself, using a web or native app run by an e-commerce company that needs to know where to ship a purchased item, or it might be his friend who is using an online address book service to collect contact information, or it might be a survey company that uses an autonomous web service to compile population demographics. A variety of scenarios and use cases can be found in <a href="#UMA-usecases">[UMA-usecases]</a> and <a href="#UMA-casestudies">[UMA-casestudies]</a>.</p>
<p id="rfc.section.1.p.3">Practical control of access among loosely coupled parties requires more than just messaging protocols. This specification defines only the technical "contract" between UMA-conforming entities; its companion Binding Obligations specification <a href="#UMA-obligations">[UMA-obligations]</a> defines the expected behaviors of parties operating and using these entities. Parties operating entities that claim to be UMA-conforming MUST provide documentation affirmatively stating their acceptance of the binding obligations contractual framework defined in the Binding Obligations specification.</p>
<p id="rfc.section.1.p.4">In enterprise settings, application access management sometimes involves letting back-office applications serve only as policy enforcement points (PEPs), depending entirely on access decisions coming from a central policy decision point (PDP) to govern the access they give to requesters. This separation eases auditing and allows policy administration to scale in several dimensions. UMA makes use of a separation similar to this, letting the resource owner serve as a policy administrator crafting authorization strategies for resources under their control.</p>
<p id="rfc.section.1.p.5">In order to increase interoperable communication among the authorization server, resource server, and client, UMA defines several purpose-built APIs related to the outsourcing of authorization, themselves protected by OAuth in embedded fashion.</p>
<p id="rfc.section.1.p.6">The UMA protocol has three broad phases, as shown in <a href="#UMA-phases">Figure 1</a>.</p>
<div id="rfc.figure.1"/>
<div id="UMA-phases"/>
<p>The Three Phases of the UMA Profile of OAuth</p>
<pre>                                           +--------------+
                                           |   resource   |
          +---------manage (A)------------ |     owner    |
          |                                +--------------+
          |         Phase 1:                      |
          |         protect a                control (B)
          |         resource                      |
          v                                       v
   +------------+               +----------+--------------+
   |            |               |protection|              |
   |  resource  |               |   API    | authorization|
   |   server   |&lt;-protect (C)--|  (needs  |    server    |
   |            |               |   PAT)   |              |
   +------------+               +----------+--------------+
   | protected  |                          | authorization|
   | resource   |                          |     API      |
   |(needs RPT) |                          |  (needs AAT) |
   +------------+                          +--------------+
          ^                                       |
          |         Phases 2 and 3:         authorize (D)
          |         get authorization,            |
          |         access a resource             v
          |                                +--------------+
          +---------access (E)-------------|    client    |
                                           +--------------+

                                           requesting party
</pre>
<p class="figure">Figure 1</p>
<p id="rfc.section.1.p.7">The phases work as follows: </p>

<dl>
  <dt>Protect a resource</dt>
  <dd style="margin-left: 8">(Described in <a href="#protecting-a-resource">Section 2</a>.) The resource owner, who manages online resources at the resource server ("A"), introduces it to the authorization server so that the latter can begin controlling the resources' protection. To accomplish this protection, the authorization server presents a protection API ("C") to the resource server. This API is OAuth-protected and requires a protection API token (PAT) for access. The API consists of an OAuth resource set registration endpoint as defined by <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a>, an endpoint for registering client-requested permissions, and an OAuth token introspection endpoint as defined by <a href="#OAuth-introspection">[OAuth-introspection]</a>. Out of band, the resource owner configures the authorization server with policies associated with the registered resource sets ("B").</dd>
  <dt>Get authorization</dt>
  <dd style="margin-left: 8">(Described in <a href="#getting-authz-accessing-resource">Section 3</a>.) The client approaches the resource server seeking access to a protected resource. In order to access it successfully, the client must first use the authorization server's authorization API ("D") to obtain a requesting party token (RPT) on behalf of its requesting party, and the requesting party must supply to the authorization server any identity claims needed in order for the server to associate sufficient authorization data with that RPT. The API is OAuth-protected and requires an authorization API token (AAT) for access. The API consists of an RPT issuance endpoint and an authorization request endpoint.</dd>
  <dt>Access a resource</dt>
  <dd style="margin-left: 8">(Described along with Phase 2 in <a href="#getting-authz-accessing-resource">Section 3</a>.) The client successfully presents an RPT that has sufficient authorization data associated with it to the resource server, gaining access to the desired resource ("E"). In this sense, this phase is the "happy path" within phase 2. The nature of the authorization data varies according to the RPT profile in use.</dd>
</dl>
<p id="rfc.section.1.p.8">Implementers are anticipated to develop profiles (see <a href="#profiles">Section 5</a>) that specify and restrict various UMA protocol, RPT, and identity claim options, according to deployment and usage conditions.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Notational Conventions</h1>
<p id="rfc.section.1.1.p.1">The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">Unless otherwise noted, all the protocol properties and values are case sensitive.</p>
<h1 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.1.2.p.1">UMA introduces the following new terms and enhancements of OAuth term definitions.</p>

<dl>
  <dt>resource owner</dt>
  <dd style="margin-left: 6"><br/>An OAuth resource that is the "user" in User-Managed Access. This is typically an end-user (a natural person) but it can also be a corporation or other legal person.</dd>
  <dt>requesting party</dt>
  <dd style="margin-left: 6"><br/>An end-user, or a corporation or other legal person, that uses a client to seek access to a protected resource. The requesting party may or may not be the same party as the resource owner.</dd>
  <dt>client</dt>
  <dd style="margin-left: 6"><br/>An application making protected resource requests with the resource owner's authorization and on the requesting party's behalf.</dd>
  <dt>claim</dt>
  <dd style="margin-left: 6"><br/>A statement of the value or values of one or more identity attributes of a requesting party. A requesting party may need to provide claims to an authorization server in order to satisfy policy and gain permission for access to a protected resource.</dd>
  <dt>resource set</dt>
  <dd style="margin-left: 6">A set of one or more protected resources. In authorization policy terminology, a resource set is the "object" being protected.</dd>
  <dt>scope</dt>
  <dd style="margin-left: 6">A bounded extent of access that is possible to perform on a resource set. In authorization policy terminology, a scope is one of the potentially many "verbs" that can logically apply to a resource set ("object"). UMA associates scopes with labeled resource sets.</dd>
  <dt>authorization data</dt>
  <dd style="margin-left: 6">Data associated with a requesting party token that enables some combination of the authorization server and resource server to determine the correct extent of access to allow to a client. Authorization data is a key part of the definition of an RPT profile.</dd>
  <dt>permission</dt>
  <dd style="margin-left: 6">A scope of access over a particular resource set at a particular resource server that is being requested by, or granted to, a requesting party. In authorization policy terminology, a permission is an entitlement that includes a "subject" (requesting party), "verbs" (one or more scopes of access), and an "object" (resource set). A permission is one example of authorization data that an authorization server may issue.</dd>
  <dt>permission ticket</dt>
  <dd style="margin-left: 6">A correlation handle that is conveyed from an authorization server to a resource server, from a resource server to a client, and ultimately from a client to an authorization server, to enable the authorization server to assess the correct resource owner policies to apply to a request for an authorization grant.</dd>
</dl>
<h1 id="rfc.section.1.3"><a href="#rfc.section.1.3">1.3.</a> <a href="#endpoint-discussion" id="endpoint-discussion">APIs and Protection</a></h1>
<p id="rfc.section.1.3.p.1">UMA involves three APIs, all of which are protected.</p>
<p id="rfc.section.1.3.p.2">The authorization server has the opportunity to manage the validity periods of access tokens that it issues, their corresponding refresh tokens where applicable, the individual data components associated with RPTs where applicable, and even the client credentials that it issues. Different time-to-live strategies may be suitable for different resources and scopes of access, and the authorization server has the opportunity to give the resource owner control over lifetimes of tokens and authorization data issued on their behalf through policy. These options are all outside the scope of this specification.</p>
<h1 id="rfc.section.1.3.1"><a href="#rfc.section.1.3.1">1.3.1.</a> Protection and Authorization APIs at the Authorization Server</h1>
<p id="rfc.section.1.3.1.p.1">The authorization server presents a protection API to the resource server and an authorization API to the client. These APIs MUST be OAuth-protected; thus, the authorization server has an OAuth token endpoint and user authorization endpoint, and has the option to issue an OAuth refresh token along with any access tokens issued for these APIs.</p>
<p id="rfc.section.1.3.1.p.2">The protection API consists of an OAuth resource set registration endpoint as defined by <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a>, an endpoint for registering client-requested permissions, and an OAuth token introspection endpoint as defined by <a href="#OAuth-introspection">[OAuth-introspection]</a>. This specification profiles the endpoints defined by these other specifications.</p>
<p id="rfc.section.1.3.1.p.3">The authorization API consists of an RPT issuance endpoint and an authorization request endpoint.</p>
<p id="rfc.section.1.3.1.p.4">All endpoint URIs SHOULD require the use of a transport-layer security mechanism such as TLS. The authorization server MUST declare all of its endpoints in its configuration data (see <a href="#am-endpoints">Section 1.4</a>).</p>
<p id="rfc.section.1.3.1.p.5">An entity seeking protection API access MUST request the scope "http://docs.kantarainitiative.org/uma/scopes/prot.json", and an access token with at least this scope is called a protection API token (PAT). An entity seeking authorization API access MUST request the scope "http://docs.kantarainitiative.org/uma/scopes/authz.json", and an access token with at least this scope is called an authorization API token (AAT). The same entity can serve in both roles, so that an OAuth access token might be considered both a PAT and an AAT if it has both scopes. If a request to an endpoint fails due to an invalid, missing, or expired PAT or AAT, or requires higher privileges at this endpoint than provided by the PAT or AAT, the authorization server responds with an OAuth error.</p>
<p id="rfc.section.1.3.1.p.6">Note: These scope keywords are URIs that resolve to JSON-encoded scope descriptions, as defined in <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a>. These scope descriptions are non-normative for the purposes of PATs and AATs.</p>
<p id="rfc.section.1.3.1.p.7">The authorization server is REQUIRED to support the OAuth bearer token profile for PAT and AAT issuance, and MAY support other OAuth token profiles for these purposes. It MUST declare all supported token profiles for PAT and AAT issuance in its configuration data. The authorization server MAY support the use of any OAuth grant type for PAT and AAT issuance, but MUST support the authorization_code grant type, and SHOULD support the SAML bearer token grant type <a href="#OAuth-SAML">[OAuth-SAML]</a> (urn:ietf:params:oauth:grant-type:saml2-bearer) if it anticipates working with entities that are operating in environments where the use of SAML is prevalent. It MUST declare its supported grant types for PAT and AAT issuance in its configuration data.</p>
<p id="rfc.section.1.3.1.p.8">A PAT binds a resource owner, a resource server the owner uses for resource management, and an authorization server the owner uses for protection of resources at this resource server. It is not specific to any client or requesting party. The issuance of a PAT represents the approval of the resource owner for this resource server to trust this authorization server for protecting its resources belonging to this resource owner.</p>
<p id="rfc.section.1.3.1.p.9">An AAT binds a requesting party, a client being used by that party, and an authorization server that protects resources this client is seeking access to on this requesting party's behalf. It is not specific to any resource server or resource owner. The issuance of an AAT represents the approval of this requesting party for this client to engage with this authorization server to supply claims, ask for authorization, and perform any other tasks needed for obtaining authorization for access to resources at all resource servers that use this authorization server. The authorization server is able to manage future processes of authorization and claims-caching efficiently for this client/requesting party pair across all resource servers they try to access. These management processes are outside the scope of this specification, however.</p>
<h1 id="rfc.section.1.3.2"><a href="#rfc.section.1.3.2">1.3.2.</a> API at the Resource Server</h1>
<p id="rfc.section.1.3.2.p.1">The resource server presents one or more protected resource endpoints to the client; these endpoints are protected by the UMA profile of OAuth and require a requesting party token (RPT) with sufficient authorization data for access. This specification defines one RPT profile, call "bearer" (see <a href="#uma-bearer-token-profile">Section 3.3.2</a>), which is REQUIRED for the authorization server to support. It MAY support additional RPT profiles. It MUST declare all supported RPT profiles in its configuration data.</p>
<p id="rfc.section.1.3.2.p.2">An RPT represents a binding of a requesting party, the client being used by that party, the resource server at which protected resources of interest reside, and the authorization server that protects those resources. It is not specific to a single resource owner, though its internal components are likely to be bound to individual resource owners, depending on the RPT profile in use.</p>
<h1 id="rfc.section.1.4"><a href="#rfc.section.1.4">1.4.</a> <a href="#am-endpoints" id="am-endpoints">Authorization Server Configuration Data</a></h1>
<p id="rfc.section.1.4.p.1">The authorization server MUST provide configuration data in a JSON <a href="#RFC4627">[RFC4627]</a> document that resides in an /uma-configuration directory at at its hostmeta <a href="#hostmeta">[hostmeta]</a> location. The configuration data documents conformance options and endpoints supported by the authorization server. (At the appropriate time, this section will instead profile whatever self-describing metadata specification OAuth adopts, for example, <a href="#OAuth-linktypes">[OAuth-linktypes]</a> or <a href="#OAuth-meta">[OAuth-meta]</a>.)</p>
<p id="rfc.section.1.4.p.2">The configuration data has the following properties.</p>

<dl>
  <dt>version</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The version of the UMA core protocol to which this authorization server conforms. The value MUST be the string "1.0".</dd>
  <dt>issuer</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. A URI indicating the party operating the authorization server.</dd>
  <dt>pat_profiles_supported</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. Access token profiles supported by this authorization server for PAT issuance. The property value is an array of string values, where each string value is either a reserved keyword defined in this specification or a URI identifying an access token profile defined elsewhere. The reserved keyword "bearer" as a value for this property stands for the OAuth bearer token profile <a href="#OAuth-bearer">[OAuth-bearer]</a>. The authorization server is REQUIRED to support this profile, and to supply this string value explicitly. The authorization server MAY declare its support for additional access token profiles for PATs.</dd>
  <dt>aat_profiles_supported</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. Access token profiles supported by this authorization server for AAT issuance. The property value is an array of string values, where each string value is either a reserved keyword defined in this specification or a URI identifying an access token profile defined elsewhere. The reserved keyword "bearer" as a value for this property stands for the OAuth bearer token profile <a href="#OAuth-bearer">[OAuth-bearer]</a>. The authorization server is REQUIRED to support this profile, and to supply this string value explicitly. The authorization server MAY declare its support for additional access token profiles for AATs.</dd>
  <dt>rpt_profiles_supported</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. Access token profiles supported by this authorization server for RPT issuance. The property value is an array of string values, where each string value is either a reserved keyword defined in this specification or a URI identifying an access token profile defined elsewhere. The reserved keyword "bearer" as a value for this property stands for the UMA bearer RPT profile defined in <a href="#OAuth-bearer">[OAuth-bearer]</a>. The authorization server is REQUIRED to support this profile, and to supply this string value explicitly. The authorization server MAY declare its support for additional access token profiles for RPTs.</dd>
  <dt>pat_grant_types_supported</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. OAuth grant types supported by this authorization server in issuing PATs. The property value is an array of string values. Each string value MUST be one of the grant_type values defined in <a href="#OAuth2">[OAuth2]</a>, or alternatively a URI identifying a grant type defined elsewhere.</dd>
  <dt>aat_grant_types_supported</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. OAuth grant types supported by this authorization server in issuing AATs. The property value is an array of string values. Each string value MUST be one of the grant_type values defined in <a href="#OAuth2">[OAuth2]</a>, or alternatively a URI identifying a grant type defined elsewhere.</dd>
  <dt>claim_profiles_supported</dt>
  <dd style="margin-left: 6"><br/>OPTIONAL. Claim formats and associated sub-protocols for gathering claims from requesting parties, as supported by this authorization server. The property value is an array of string values, which each string value is either a reserved keyword defined in this specification or a URI identifying a claim profile defined elsewhere. The reserved keyword "openid" as a value for this property stands for the UMA OpenID Connect claim profile defined in <a href="#trusted-claims">Section 3.5.1.1</a>.</dd>
  <dt>dynamic_client_endpoint</dt>
  <dd style="margin-left: 6"><br/>OPTIONAL. The endpoint to use for performing dynamic client registration. Usage is defined by <a href="#DynClientReg">[DynClientReg]</a>. The presence of this property indicates authorization server support for the dynamic client registration feature and its absent indicates a lack of support.</dd>
  <dt>token_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the resource server or client asks the authorization server for a PAT or AAT, respectively. A requested scope of "http://docs.kantarainitiative.org/uma/scopes/prot.json" results in a PAT. A requested scope of "http://docs.kantarainitiative.org/uma/scopes/authorization" results in an AAT. Usage is defined by <a href="#OAuth2">[OAuth2]</a>.</dd>
  <dt>user_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the resource server gathers the consent of the end-user resource owner or the client gathers the consent of the end-user requesting party, if the "authorization_code" grant type is used. Usage is defined by <a href="#OAuth2">[OAuth2]</a>.</dd>
  <dt>introspection_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the resource server introspects an RPT presented to it by a client. Usage is defined by <a href="#OAuth-introspection">[OAuth-introspection]</a> and <a href="#token-introspection">Section 3.3.1</a>. A valid PAT MUST accompany requests to this protected endpoint.</dd>
  <dt>resource_set_registration_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the resource server registers resource sets to put them under authorization manager protection. Usage is defined by <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a> and <a href="#protecting-a-resource">Section 2</a>. A valid PAT MUST accompany requests to this protected endpoint.</dd>
  <dt>permission_registration_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the resource server registers a client-requested permission with the authorization server. Usage is defined by <a href="#h-am-register-permission">Section 3.2</a>. A valid PAT MUST accompany requests to this protected endpoint.</dd>
  <dt>rpt_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the client asks the authorization server for an RPT. Usage is defined by <a href="#authz-permission-token">Section 3.4.1</a>. A valid AAT MUST accompany requests to this protected endpoint.</dd>
  <dt>authorization_request_endpoint</dt>
  <dd style="margin-left: 6"><br/>REQUIRED. The endpoint URI at which the client asks to have authorization data associated with its RPT. Usage is defined in <a href="#r-am-authz-scope">Section 3.4.2</a>. A valid AAT MUST accompany requests to this protected endpoint.</dd>
</dl>
<p>Example of authorization server configuration data that resides at https://example.com/.well-known/uma-configuration (note the use of https: for endpoints throughout):</p>
<pre>{
"version":"1.0",
"issuer":"https://example.com",
"pat_profiles_supported":["bearer"],
"aat_profiles_supported":["bearer"],
"rpt_profiles_supported":["bearer"],
"pat_grant_types_supported":["authorization_code"],
"aat_grant_types_supported":["authorization_code"],
"claim_profiles_supported":["openid"],
"dynamic_client_endpoint":"https://as.example.com/dyn_client_reg_uri",
"token_endpoint":"https://as.example.com/token_uri",
"user_endpoint":"https://as.example.com/user_uri",
"resource_set_registration_endpoint":"https://as.example.com/rs/rsrc_uri",
"introspection_endpoint":"https://as.example.com/rs/status_uri",
"permission_registration_endpoint":"https://as.example.com/rs/perm_uri",
"rpt_endpoint":"https://as.example.com/client/rpt_uri",
"authorization_request_endpoint":"https://as.example.com/client/perm_uri"
}</pre>
<p class="figure"></p>
<p id="rfc.section.1.4.p.3">Authorization server configuration data MAY contain extension properties that are not defined in this specification. Extension names that are unprotected from collisions are outside the scope of this specification.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#protecting-a-resource" id="protecting-a-resource">Protecting a Resource</a></h1>
<p id="rfc.section.2.p.1">The resource owner, resource server, and authorization server perform the following actions to put resources under protection. This list assumes that the resource server has discovered the authorization server's configuration data and endpoints as needed.</p>

<ol>
  <li>The authorization server issues client credentials to the resource server. It is OPTIONAL for the client credentials to be provided dynamically through <a href="#DynClientReg">[DynClientReg]</a>); alternatively, they MAY use a static process.</li>
  <li>The resource server acquires a PAT from the authorization server in order to use the resource set registration endpoint (and later, other protection API endpoints). It is OPTIONAL for the resource owner to introduce the resource server to the authorization server dynamically (for example, through a "NASCAR"-style user interface where the resource owner selects a chosen authorization server); alternatively, they MAY use a static process that may or may not directly involve the resource owner at introduction time.</li>
  <li>In an ongoing fashion, the resource server registers any resource sets with the authorization server for which it intends to outsource protection, using the process defined by <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a>.</li>
</ol>
<p id="rfc.section.2.p.2">Note: The resource server is free to offer the option to protect any subset of the resource owner's resources using different authorization servers or other means entirely, or to protect some resources and not others. Additionally, the choice of protection regimes can be made explicitly by the resource owner or implicitly by the resource server. Any such partitioning by the resource server or owner is outside the scope of this specification.</p>
<p id="rfc.section.2.p.3">Once a resource set has been placed under authorization server protection through the registration of a resource set description for it, and until such a description's deletion by the resource server, the resource server MUST limit access to corresponding resources, respecting authorization data associated with client-presented RPTs by the authorization server as appropriate (see <a href="#client-presents-rpt">Section 3.1.2</a>).</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#getting-authz-accessing-resource" id="getting-authz-accessing-resource">Getting Authorization and Accessing a Resource</a></h1>
<p id="rfc.section.3.p.1">An authorization server orchestrates and controls clients' access (on their requesting parties' behalf) to a resource owner's protected resources at a resource server, under conditions dictated by that resource owner.</p>
<p id="rfc.section.3.p.2">The process of getting authorization and accessing a resource always begins with the client attempting access at a protected resource endpoint at the resource server. How the client came to learn about this endpoint is out of scope for this specification. The resource owner might, for example, have advertised its availability publicly on a blog or other website, listed it in a discovery service, or emailed a link to a particular intended requesting party.</p>
<p id="rfc.section.3.p.3">The resource server responds to the client's access request with whatever its application-specific interface defines as a success response, either immediately or having first performed one or more embedded interactions with the authorization server. Depending on the nature of the resource server's response to an failed access attempt, the client and its requesting party engage in embedded interactions with the authorization server before re-attempting access.</p>
<p id="rfc.section.3.p.4">The interactions are as follows. Each interaction MAY be the last, if the client chooses not to continue pursuing the access attempt or the resource server chooses not to continue facilitating it.</p>

<ul>
  <li>The client attempts to access a protected resource.<ul><li>If the access attempt is unaccompanied by an RPT, the resource server responds immediately with an HTTP 401 (Unauthorized) response and instructions on where to go to obtain one.</li><li>If the access attempt was accompanied by an RPT, the resource server checks the RPT's status.<ul><li>If the RPT is invalid, the resource server responds with an HTTP 401 (Unauthorized) response and instructions on where to go to obtain a token.</li><li>If the RPT is valid but has insufficient authorization data, the resource server registers a suitable requested permission on the client's behalf at the authorization server, and then responds to the client with an HTTP 403 (Forbidden) response and instructions on where to go to ask for authorization.</li><li>If the RPT is valid, and if the authorization data associated with the token is sufficient for allowing access, the resource server responds with an HTTP 2xx (Success) response and a representation of the resource.</li></ul></li></ul></li>
  <li>If the client (possessing no RPT or an invalid RPT) received a 401 response and an authorization server's location, after looking up its configuration data and endpoints as necessary, it requests an RPT from the RPT endpoint.</li>
  <li>If the client (posessing a valid RPT) received a 403 response and a permission ticket, it asks the authorization server for authorization data that matches the ticket. If the authorization server needs requesting party claims in order to assess this client's authorization, it engages in a claims-gathering flow with the requesting party.<ul><li>If the client does not already have an AAT at the appropriate authorization server to be able to use its authorization API, it first obtains one.</li></ul></li>
</ul>
<p id="rfc.section.3.p.5">The interactions are described in detail in the following sections.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#r-h-attempt-access" id="r-h-attempt-access">Client Attempts to Access Protected Resource</a></h1>
<p id="rfc.section.3.1.p.1">This interaction assumes that the resource server has previously registered one or more resource sets that correspond to the resource to which access is being attempted.</p>
<p id="rfc.section.3.1.p.2">The client attempts to access a protected resource (for example, when an end-user requesting party clicks on a thumbnail representation of the resource to retrieve a larger version). It is expected to discover, or be provisioned or configured with, knowledge of the protected resource and its location out of band. Further, the client is expected to acquire its own knowledge about the application-specific methods made available by the resource server for operating on this protected resource (such as viewing it with a GET method, or transforming it with some complex API call) and the possible scopes of access.</p>
<p id="rfc.section.3.1.p.3">The access attempt either is or is not accompanied by an RPT.</p>
<h1 id="rfc.section.3.1.1"><a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#no-rpt" id="no-rpt">Client Presents No RPT</a></h1>
<p>Example of a request carrying no RPT:</p>
<pre>
GET /album/photo.jpg HTTP/1.1
Host: photoz.example.com
...
</pre>
<p class="figure"></p>
<p id="rfc.section.3.1.1.p.1">If the client does not present an RPT with the request, the resource server MUST return an HTTP 401 (Unauthorized) status code, along with providing the authorization server's URI in an "as_uri" property to facilitate authorization server configuration data discovery, including discovery of the endpoint where the client can request an RPT (<a href="#authz-permission-token">Section 3.4.1</a>).</p>
<p>For example:</p>
<pre>
HTTP/1.1 401 Unauthorized
   WWW-Authenticate: UMA realm="example",
    host_id="photoz.example.com",
    as_uri="https://as.example.com"
   ...
</pre>
<p class="figure"></p>
<h1 id="rfc.section.3.1.2"><a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#client-presents-rpt" id="client-presents-rpt">Client Presents RPT</a></h1>
<p>Example of a request carrying an RPT using the UMA bearer RPT profile:</p>
<pre>
GET /album/photo.jpg HTTP/1.1
Authorization: Bearer vF9dft4qmT
Host: photoz.example.com
...
</pre>
<p class="figure"></p>
<p id="rfc.section.3.1.2.p.1">If the client presents an RPT with its request, the resource server MUST determine the RPT's status (see <a href="#h-am-rpt-status">Section 3.3</a>) before responding.</p>
<p id="rfc.section.3.1.2.p.2">If the RPT is invalid, the resource server MUST return an HTTP 401 (Unauthorized) status code, along with providing the authorization server's URI in an "as_uri" property in the header, similarly to the case where no RPT was presented.</p>
<p id="rfc.section.3.1.2.p.3">If the RPT is valid but has insufficient authorization data for the type of access sought, the resource server SHOULD register a requested permission with the authorization server that would suffice for that scope of access (see <a href="#h-am-register-permission">Section 3.2</a>), and then respond with the HTTP 403 (Forbidden) status code, along with providing the authorization server's URI in an "as_uri" property in the header, and the permission ticket it just received from the AM in the body in a JSON-encoded "ticket" property.</p>
<p>Example of the host's response after having registered a requested permission and received a ticket:</p>
<pre>
HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  host_id="photoz.example.com",
  as_uri="https://as.example.com"
  error="insufficient_scope"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}
</pre>
<p class="figure"></p>
<p id="rfc.section.3.1.2.p.4">If the RPT's status is associated with authorization data that is consistent with authorized access of the scope sought by the client, the resource server MUST give access to the desired resource.</p>
<p>Example of the resource server's response after having determineed that the RPT is valid and associated with sufficient authorization data:</p>
<pre>
HTTP/1.1 200 OK
Content-Type: image/jpeg
...

/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja
3kAAQAEAAAAPAAA/+4ADkFkb2JlAGTAAAAAAf
/bAIQABgQEBAUEBgUFBgkGBQYJCwgGBggLDAo
KCwoKDBAMDAwMDAwQDA4PEA8ODBMTFBQTExwb
</pre>
<p class="figure"></p>
<p id="rfc.section.3.1.2.p.5">The resource server MUST NOT give access where the token's status is not associated with sufficient authorization data for the attempted scope of access.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#h-am-register-permission" id="h-am-register-permission">Resource Server Registers Requested Permission With Authorization Server</a></h1>
<p id="rfc.section.3.2.p.1">In response to receiving an access request accompanied by an RPT that has insufficient authorization data, the resource server registers a permission with the authorization server that would be sufficient for the type of access sought. The authorization server returns a permission ticket for the resource server to give to the client in its response.</p>
<p id="rfc.section.3.2.p.2">The resource server MUST provide its valid PAT in order to get access to this endpoint. Note that this PAT implicitly identifies the resource owner ("subject") to which the permission applies.</p>
<p id="rfc.section.3.2.p.3">The permission ticket is a short-lived opaque structure whose form is determined by the authorization server. The ticket value MUST be securely random (for example, not merely part of a predictable sequential series), to avoid denial-of-service attacks. Since the ticket is an opaque structure from the point of view of the client, the authorization server is free to include information regarding expiration time within the opaque ticket for its own consumption. When the client subsequently asks the authorization server for authorization data to be associated with its RPT, it will submit this ticket to the authorization server.</p>
<p id="rfc.section.3.2.p.4">The resource server registers the requested permission using the POST method at the authorization server's permission registration endpoint. The resource server MUST provide its valid PAT in order to get access to this endpoint. The body of the HTTP request message contains a JSON object providing the requested permission, using a format derived from the scope description format specified in <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a>, as follows. The object has the following properties:</p>

<dl>
  <dt>resource_set_id</dt>
  <dd style="margin-left: 8">REQUIRED. The identifier for a resource set, access to which this client is seeking access. The identifier MUST correspond to a resource set that was previously registered.</dd>
  <dt>scopes</dt>
  <dd style="margin-left: 8">REQUIRED. An array referencing one or more identifiers of scopes to which access is needed for this resource set. Each scope identifier MUST correspond to a scope that was registered by this resource server for the referenced resource set.</dd>
</dl>
<p>Example of an HTTP request that registers a requested permission at the authorization server's permission registration endpoint:</p>
<pre>
POST /host/scope_reg_uri/photoz.example.com HTTP/1.1
Content-Type: application/json
Host: as.example.com

{
  "resource_set_id": "112210f47de98100",
  "scopes": [
      "http://photoz.example.com/dev/actions/view",
      "http://photoz.example.com/dev/actions/all"
  ]
}
</pre>
<p class="figure"></p>
<p id="rfc.section.3.2.p.5">If the registration request is successful, the authorization server responds with an HTTP 201 (Created) status code and includes the Location header in its response as well as the "ticket" property in the JSON-formatted body.</p>
<p>For example:</p>
<pre>
HTTP/1.1 201 Created
Content-Type: application/json
Location: https://as.example.com/permreg/host/photoz.example.com/5454345rdsaa4543
...

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}
</pre>
<p class="figure"></p>
<p id="rfc.section.3.2.p.6">If the registration request is authenticated properly but fails due to other reasons, the authorization server responds with an HTTP 400 (Bad Request) status code and includes one of the following UMA error codes (see <a href="#uma-error-response">Section 4.2</a>):</p>

<dl>
  <dt>invalid_resource_set_id</dt>
  <dd style="margin-left: 8">The provided resource set identifier was not found at the authorization server.</dd>
  <dt>invalid_scope</dt>
  <dd style="margin-left: 8">At least one of the scopes included in the request was not registered previously by this resource server.</dd>
</dl>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#h-am-rpt-status" id="h-am-rpt-status">Resource Server Determines RPT's Status</a></h1>
<p id="rfc.section.3.3.p.1">The resource server determines a received RPT's status, including both its validity and, if valid, its associated authorization data, before giving or refusing access to the client. An RPT is associated with a set of authorization data that governs whether the client is authorized for access. The token's nature and format are dictated by its profile; the profile might allow it to be self-contained, such that the resource server is able to determine its status locally, or might require or allow the resource server to make a run-time introspection request of the authorization server that issued the token.</p>
<p id="rfc.section.3.3.p.2">This specification makes one type of RPT mandatory to implement: the UMA bearer token profile, as defined in <a href="#uma-bearer-token-profile">Section 3.3.2</a>. Implementers MAY define and use other RPT profiles.</p>
<h1 id="rfc.section.3.3.1"><a href="#rfc.section.3.3.1">3.3.1.</a> <a href="#token-introspection" id="token-introspection">Token Introspection</a></h1>
<p id="rfc.section.3.3.1.p.1">Within any RPT profile, when a resource server needs to introspect a token in a non-self-contained way to determine its status, it MUST use the authorization server's OAuth introspection endpoint, defined by <a href="#OAuth-introspection">[OAuth-introspection]</a>. Any UMA token profile MAY require, allow, or prohibit use of the token introspection endpoint, and MAY profile its usage. The authorization server MUST OAuth-protect this endpoint and require a PAT from the resource server for access to it. The resource server MUST use the POST method in interacting with the endpoint, not the GET method also defined by <a href="#OAuth-introspection">[OAuth-introspection]</a>.</p>
<h1 id="rfc.section.3.3.2"><a href="#rfc.section.3.3.2">3.3.2.</a> <a href="#uma-bearer-token-profile" id="uma-bearer-token-profile">RPT Profile: Bearer</a></h1>
<p id="rfc.section.3.3.2.p.1">This section defines the UMA bearer token profile. Following is a summary:</p>

<ul>
  <li>Identifying URI: http://docs.kantarainitiative.org/uma/profiles/uma-token-bearer-1.0</li>
  <li>Profile author and contact information: Thomas Hardjono (hardjono@mit.edu)</li>
  <li>Updates or obsoletes: None; this profile is new.</li>
  <li>Keyword in HTTP Authorization header: "Bearer".</li>
  <li>Syntax and semantics of token data: As defined below. The token data format mainly involves time-bounded permissions.</li>
  <li>Token data association: The data associated to the on-the-wire token by reference and retrieved at run time by the resource server through profiled use of the OAuth token introspection endpoint <a href="#OAuth-introspection">[OAuth-introspection]</a>, as defined below.</li>
  <li>Token data processing: As defined in this section and throughout <a href="#getting-authz-accessing-resource">Section 3</a> of this specification.</li>
  <li>Grant type restrictions: None.</li>
  <li>Error states: As defined below.</li>
  <li>Security and privacy considerations: As defined in this section and throughout <a href="#getting-authz-accessing-resource">Section 3</a> of this specification.</li>
  <li>Binding obligations: Because this RPT profile is mandatory for authorization servers to implement, binding obligations related to the use of this token profile are documented in <a href="#UMA-obligations">[UMA-obligations]</a>.</li>
</ul>
<p id="rfc.section.3.3.2.p.2">On receiving an RPT of the "Bearer" type in an authorization header from a client making an access attempt, the resource server MUST introspect the token by using the authorization server's token introspection endpoint. The PAT used by the resource server to make the introspection request provides resource-owner context to the authorization server.</p>
<p id="rfc.section.3.3.2.p.3">The authorization server responds with a JSON object with the structure dictated by <a href="#OAuth-introspection">[OAuth-introspection]</a>. If the valid property has a "true" value, then the JSON object MUST also contain an extension property with the name "permissions" that contains an array of zero or more values, each of which is an object consisting of these properties:</p>

<dl>
  <dt>resource_set_id</dt>
  <dd style="margin-left: 8">REQUIRED. A string that uniquely identifies the resource set, access to which has been granted to this client on behalf of this requesting party. The identifier MUST correspond to a resource set that was previously registered as protected.</dd>
  <dt>scopes</dt>
  <dd style="margin-left: 8">REQUIRED. An array referencing one or more URIs of scopes to which access was granted for this resource set. Each scope MUST correspond to a scope that was registered by this host for the referenced resource set.</dd>
  <dt>expires_at</dt>
  <dd style="margin-left: 8">REQUIRED. Integer timestamp, measured in the number of seconds since January 1 1970 UTC, indicating when this permission will expire.</dd>
  <dt>issued_at</dt>
  <dd style="margin-left: 8">OPTIONAL. Integer timestamp, measured in the number of seconds since January 1 1970 UTC, indicating when this permission was originally issued.</dd>
</dl>
<p>Example:</p>
<pre>
HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
    "valid": true,
    "expires_at": "1256953732",
    "issued_at": "1256912345",
    "permissions": [
      {
        "resource_set_id": "112210f47de98100",
        "scopes": [
          "http://photoz.example.com/dev/actions/view",
          "http://photoz.example.com/dev/actions/all"
         ],
        "expires_at" : "1256923456"
      }
    ]
   }
</pre>
<p class="figure"></p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> <a href="#r-am-obtain-permission" id="r-am-obtain-permission">Client Seeks Authorization for Access</a></h1>
<p id="rfc.section.3.4.p.1">In order to access a protected resource successfully, a client needs to present a valid RPT with sufficient authorization data for access. To get to this stage requires a number of previously successful steps:</p>

<ol>
  <li>The authorization server issues client credentials to the client. It is OPTIONAL for the client credentials to be provided dynamically through <a href="#DynClientReg">[DynClientReg]</a>); alternatively, they MAY use a static process.</li>
  <li>The client acquires an AAT. This enables it to use authorization API endpoints.</li>
  <li>The client acquires an RPT from the RPT endpoint. See <a href="#authz-permission-token">Section 3.4.1</a> for more detail.</li>
  <li>The client asks for authorization at the authorization request endpoint, providing the permission ticket it got from the resource server. The authorization server associates authorization data with the client's RPT based on the permission ticket, the resource owner's operative policies, and the results of any claims-gathering flows with the requesting party. See <a href="#r-am-authz-scope">Section 3.4.2</a> for more detail.</li>
</ol>
<h1 id="rfc.section.3.4.1"><a href="#rfc.section.3.4.1">3.4.1.</a> <a href="#authz-permission-token" id="authz-permission-token">Client Obtains RPT</a></h1>
<p id="rfc.section.3.4.1.p.1">The client might need an RPT if it has never before requested an RPT for this combination of requesting party, resource server, and authorization server, or if it has lost control of a previously issued RPT and needs a refreshed one. It obtains an RPT by performing a POST on the RPT endpoint. It MUST provide its own valid AAT in the header.</p>
<p>Example of a request message containing an AAT:</p>
<pre>POST /rpt HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...
</pre>
<p class="figure"></p>
<p id="rfc.section.3.4.1.p.2">The authorization server responds with an HTTP 201 (Created) status code and provides a new RPT.</p>
<p>For example:</p>
<pre>
HTTP/1.1 201 Created
Content-Type: application/json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}
</pre>
<p class="figure"></p>
<p id="rfc.section.3.4.1.p.3">If the AAT provided in the header is the same as one provided for a previously issued still-valid RPT by this authorization server, the authorization server invalidates the old RPT and issues a new one.</p>
<p id="rfc.section.3.4.1.p.4">On first issuance, the RPT is associated with no authorization data and thus does not convey any authorizations for access.</p>
<h1 id="rfc.section.3.4.2"><a href="#rfc.section.3.4.2">3.4.2.</a> <a href="#r-am-authz-scope" id="r-am-authz-scope">Client Asks for Authorization Data</a></h1>
<p id="rfc.section.3.4.2.p.1">Once in possession of an AAT for this authorization server, an RPT that applies to this requesting party for this resource server and this authorization server, and a permission ticket, the client asks the authorization server to give it suitable authorization data for the sought-for access. It performs a POST on the authorization request endpoint, supplying its own AAT in the header and its RPT and the permission ticket in a JSON object with properties "rpt" and ticket", respectively.</p>
<p>Example of a request message containing an AAT, an RPT, and a permission ticket:</p>
<pre>POST /token_status HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre>
<p class="figure"></p>
<p id="rfc.section.3.4.2.p.2">The authorization server uses the ticket to look up the details of the previously registered requested permission, maps the requested permission to operative resource owner policies based on the resource set identifier and scopes in it, undergoes any claims-gathering flows required (see <a href="#authz-flows">Section 3.5</a>), and ultimately responds to the request. The resource owner's policies at the authorization server amount to an implicit authorization grant in governing the issuance of authorization data. (The authorization server is also free to enable the resource owner to set policies that require the owner to provide a run-time authorization grant in the form of a consent interaction, mediated by the authorization server. This setting of policies and gathering of consent is outside the scope of this specification.)</p>
<p id="rfc.section.3.4.2.p.3">The authorization server MUST base the addition of authorization data to RPTs on user policies. The nature of these policies is outside the scope of UMA, but generally speaking, they can be thought of as either independent of requesting-party features (for example, time of day) or dependent on requesting-party features (for example, whether they are over 18). Such requesting-party features can potentially be collected in a claims-gathering flow. If the authorization server does not add the requested authorization data, it responds using the appropriate HTTP status code and UMA error code (see <a href="#uma-error-response">Section 4.2</a>): </p>

<dl>
  <dt>invalid_ticket</dt>
  <dd style="margin-left: 8">The provided ticket was not found at the authorization server. The authorization server SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
  <dt>expired_ticket</dt>
  <dd style="margin-left: 8">The provided ticket has expired. The authorization server SHOULD respond with the HTTP 400 (Bad Request) status code.</dd>
  <dt>not_authorized_permission</dt>
  <dd style="margin-left: 8">The client is definitively not authorized for this authorization according to user policy. The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code.</dd>
  <dt>need_claims</dt>
  <dd style="margin-left: 8">The authorization server is unable to determine whether the client is authorized for this permission without gathering claims from the requesting party. The authorization server SHOULD respond with the HTTP 403 (Forbidden) status code. The client is therefore not authorized, but has the opportunity to engage its operator -- the requesting party -- in a claims-gathering flow with the authorization server (see <a href="#authz-flows">Section 3.5</a>) to continue seeking authorization.</dd>
</dl>
<p>For example:</p>
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "expired_ticket"
}
</pre>
<p class="figure"></p>
<h1 id="rfc.section.3.5"><a href="#rfc.section.3.5">3.5.</a> <a href="#authz-flows" id="authz-flows">Claims-Gathering Flows</a></h1>
<p id="rfc.section.3.5.p.1">The process for requesting and providing claims is extensible and may have a variety of dependencies on the type of requesting party (for example, natural person or legal person) and the type of client (for example, browser, native app, or autonomously running web service). This specification provides a framework for handling end-user-driven clients and an optional "openid" claim profile, based on OpenID Connect, for gathering standardized claims from such an end-user. It also allows for the definition of additional claim profiles. The authorization server MAY support any number of claim profiles, and SHOULD document the claim profiles it supports its configuration data. For the business-level and legal implications of different claim profiles, see <a href="#UMA-obligations">[UMA-obligations]</a>.</p>
<h1 id="rfc.section.3.5.1"><a href="#rfc.section.3.5.1">3.5.1.</a> <a href="#trusted-claims-human-driven" id="trusted-claims-human-driven">Claims-Gathering Flow for Clients Operated by End-Users</a></h1>
<p id="rfc.section.3.5.1.p.1">A client, whether web-based or native, is operated by an end-user in one of two typical situations:</p>

<ul>
  <li>The requesting party is a natural person (for example, a friend of the resource owner); the requesting party may even be the resource owner herself.</li>
  <li>The requesting party is a legal person such as a corporation, and the end-user operating the client is acting as an agent of that legal person (for example, a customer support specialist representing a credit card company).</li>
</ul>
<p id="rfc.section.3.5.1.p.2">For convenience, this specification refers to the end-user as a "requesting end-user" to cover both cases, which differ only at the level of business agreements (and potentially law), rather than technology. The authorization server has a variety of options at this point for satisfying the resource owner's policy; this specification does not dictate a single answer. For example, the authorization server could require the requesting end-user to register for and/or log in to a local authorization server account, or fill in a questionnaire, or complete a purchase. It could even require several of these operations, where the order is treated as significant for evaluating resource owner policies. A variety of claim profiling can be defined to achieve these effects.</p>
<p id="rfc.section.3.5.1.p.3">An end-user-driven client MUST redirect the requesting end-user to the authorization server in order to continue the process of seeking authorization, including a URI query parameter with the name "ticket" whose value conveys the permission ticket for which the need_claims error was received; for example, "ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de".</p>
<p id="rfc.section.3.5.1.p.4">Each claim profile MUST provide the following capabilities:</p>

<dl>
  <dt>redirect URI</dt>
  <dd style="margin-left: 8">A means by which the client MUST supply the URI to which the authorization server MUST redirect the requesting end-user at the end of the claims-gathering process.</dd>
  <dt>callback URI</dt>
  <dd style="margin-left: 8">A means by which the client OPTIONALLY supplies a callback URI for the authorization server to use.</dd>
  <dt>state</dt>
  <dd style="margin-left: 8">A means by which the client SHOULD supply an opaque value used to maintain state between the request and the callback; this serves as a protection against XSRF attacks.</dd>
</dl>
<h1 id="rfc.section.3.5.1.1"><a href="#rfc.section.3.5.1.1">3.5.1.1.</a> <a href="#trusted-claims" id="trusted-claims">OpenID Connect Claim Profile</a></h1>
<p id="rfc.section.3.5.1.1.p.1">This section defines the OpenID Connect claim profile for UMA. Following is a summary:</p>

<ul>
  <li>Identifying URI: http://docs.kantarainitiative.org/uma/profiles/uma-claim-openid-1.0</li>
  <li>Profile author and contact information: Thomas Hardjono (hardjono@mit.edu)</li>
  <li>Updates or obsoletes: None; this profile is new.</li>
  <li>Syntax and semantics of claim data: As defined below. The claim data format leverages the OpenID Connect protocol and the reserved claims defined in that specification.</li>
  <li>Claims gathering method: As defined below.</li>
  <li>Error states: None additional.</li>
  <li>Security and privacy considerations: None additional.</li>
  <li>Binding obligations: Binding obligations that apply to the use of this claim profile are documented in <a href="#UMA-obligations">[UMA-obligations]</a>.</li>
</ul>
<p id="rfc.section.3.5.1.1.p.2">If an authorization server supports the OpenID Connect claim profile, it MUST supply the "openid" value for one of its "claim_profiles_supported" values in its configuration data.</p>
<p id="rfc.section.3.5.1.1.p.3">To conform to this option, the authorization server MUST do the following:</p>

<ul>
  <li>Serve as a conforming OpenID Relying Party and Claims Client according to <a href="#OCStandard">[OCStandard]</a></li>
  <li>Be able to utilize at least all of the reserved claims defined in <a href="#OCMessages">[OCMessages]</a> in evaluating policy and adding authorization data to RPTs</li>
  <li>Use the OpenID Connect "redirect_uri" and "state" request parameters as appropriate</li>
</ul>
<p id="rfc.section.3.5.1.1.p.4">The authorization server can then use any conforming OpenID Connect mechanisms and typical user interfaces for engaging with the UserInfo endpoints of OpenID Providers and Claims Providers, potentially allowing for the delivery of "trusted claims" (such as a verified email address or a date or birth) on which authorization policy for access may depend.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#errors" id="errors">Error Messages</a></h1>
<p id="rfc.section.4.p.1">Ultimately the resource server is responsible for either granting the access the client attempted, or returning an error response to the client with a reason for the failure. <a href="#OAuth2">[OAuth2]</a> defines several error responses for a resource server to return. UMA makes use of these error responses, but requires the resource server to "outsource" the determination of some error conditions to the authorization server. This specification defines additional UMA-specific error responses that the authorization server may give to the resource server and client as they interact with it, and that the resource server may give to the client.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#oauth-error-response" id="oauth-error-response">OAuth Error Responses</a></h1>
<p id="rfc.section.4.1.p.1">When a resource server or client attempts to access one of the authorization server endpoints or a client attempts to access a protected resource at the resource server, it has to make an authenticated request by including an OAuth access token in the HTTP request as described in <a href="#OAuth2">[OAuth2]</a> Section 7.2.</p>
<p id="rfc.section.4.1.p.2">If the request failed authentication, the authorization server or the resource server responds with an OAuth error message as described throughout <a href="#protecting-a-resource">Section 2</a> and <a href="#getting-authz-accessing-resource">Section 3</a>.</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#uma-error-response" id="uma-error-response">UMA Error Responses</a></h1>
<p id="rfc.section.4.2.p.1">When a resource server or client attempts to access one of the authorization server endpoints or a client attempts to access a protected resource at the resource server, if the request is successfully authenticated by OAuth means, but is invalid for another reason, the authorization server or resource server responds with an UMA error response by adding the following properties to the entity body of the HTTP response: </p>

<dl>
  <dt>error</dt>
  <dd style="margin-left: 8">REQUIRED. A single error code. Values for this property are defined throughout this specification.</dd>
  <dt>error_description</dt>
  <dd style="margin-left: 8">OPTIONAL. Human-readable text providing additional information.</dd>
  <dt>error_uri</dt>
  <dd style="margin-left: 8">OPTIONAL. A URI identifying a human-readable web page with information about the error.</dd>
</dl>
<p id="rfc.section.4.2.p.2">The following is a common error code that applies to several UMA-specified request messages: </p>

<dl>
  <dt>invalid_request</dt>
  <dd style="margin-left: 8">The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed. The authorization server MUST respond with the HTTP 400 (Bad Request) status code.</dd>
</dl>
<p>For example:</p>
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "status": "error",
  "error": "invalid_request",
  "error_description": "There is already a resource with this identifier.",
  "error_uri": "http://as.example.com/errors/resource_exists"
}
</pre>
<p class="figure"></p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#profiles" id="profiles">Specificying Additional Profiles</a></h1>
<p id="rfc.section.5.p.1">This specification defines a protocol that has optional features. For interoperability and to serve particular deployment scenarios, including sector-specific ones such as healthcare or e-government, third parties may want to define profiles of UMA that restrict these options.</p>
<p id="rfc.section.5.p.2">Further, this specification creates extensibility points for RPT profiles and claim profiles, and third parties may likewise want to define their own. Different RPT profile could be used, for example, to change the dividing line between authorization server and resource server responsibilities in controlling access. Different claim profiles could be used to customize sector-specific or population-specific (individual vs. employee) claim types that drive the types of policies resource owners could set.</p>
<p id="rfc.section.5.p.3">It is not practical for this specification to standardize all desired profiles. However, to serve overall interoperability goals, the following sections provide guidelines for third parties that wish to specify UMA-related profiles.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> Specifying Profiles of UMA</h1>
<p id="rfc.section.5.1.p.1">It is RECOMMENDED that profiles of UMA document the following information:</p>
<p/>

<ol>
  <li>Specify a URI that uniquely identifies the profile.</li>
  <li>Identify the responsible author and provide postal or electronic contact information.</li>
  <li>Supply references to previously defined profiles that the profile updates or obsoletes.</li>
  <li>Specify the set of interactions between endpoint entites involved in the profile, calling out any restrictions on ordinary UMA-conformant operations and any extension properties used in message formats.</li>
  <li>Identify the legally responsible parties involved in each interaction and any new obligations imposed, in the fashion of <a href="#UMA-obligations">[UMA-obligations]</a>.</li>
  <li>Define any additional or changed error states.</li>
  <li>Supply any additional security and privacy considerations, including analysis of threats and description of countermeasures.</li>
</ol>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> Specifying RPT Profiles</h1>
<p id="rfc.section.5.2.p.1">It is RECOMMENDED that RPT profiles document the following information:</p>
<p/>

<ol>
  <li>Specify a URI that uniquely identifies the token profile.</li>
  <li>Identify the responsible author and provide postal or electronic contact information.</li>
  <li>Supply references to previously defined token profiles that the token profile updates or obsoletes.</li>
  <li>Specify the keyword to be used in HTTP Authorization headers with tokens conforming to this profile.</li>
  <li>Specify the syntax and semantics of the data that the authorization server associates with the token.</li>
  <li>Specify how the token data is associated with, contained within, and/or retrieved by means of, the on-the-wire token string.</li>
  <li>Specify processing rules for token data.</li>
  <li>Identify any restrictions on grant types to be used with the token profile.</li>
  <li>Define any additional or changed error states.</li>
  <li>Supply any additional security and privacy considerations.</li>
  <li>Specify any obligations specific to the token profile, in the fashion of <a href="#UMA-obligations">[UMA-obligations]</a>.</li>
</ol>
<p id="rfc.section.5.2.p.3">See <a href="#uma-bearer-token-profile">Section 3.3.2</a> for an example.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> Specifying Claim Profiles</h1>
<p id="rfc.section.5.3.p.1">It is RECOMMENDED that claim profiles document the following information:</p>

<ol>
  <li>Specify a URI that uniquely identifies the claim profile.</li>
  <li>Identify the responsible author and provide postal or electronic contact information.</li>
  <li>Supply references to previously defined claim profiles that the claim profile updates or obsoletes.</li>
  <li>Specify the syntax and semantics of claim data and requests for claim data.</li>
  <li>Specify how an authorization server gathers the claims.</li>
  <li>Define any additional or changed error states.</li>
  <li>Supply any additional security and privacy considerations.</li>
  <li>Specify any obligations specific to the claim profile, in the fashion of <a href="#UMA-obligations">[UMA-obligations]</a>.</li>
</ol>
<p id="rfc.section.5.3.p.2">See <a href="#trusted-claims">Section 3.5.1.1</a> for an example.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> Security Considerations</h1>
<p id="rfc.section.6.p.1">This specification relies mainly on OAuth security mechanisms as well as transport-level encryption for protecting the protection and authorization API endpoints. Most PATs and AATs are likely to use OAuth bearer tokens. See <a href="#OAuth-threat">[OAuth-threat]</a> for more information.</p>
<p id="rfc.section.6.p.2">This specification defines a number of JSON-based data formats. As a subset of the JavaScript scripting language, JSON data SHOULD be consumed through a process that does not dynamically execute it as code, to avoid malicious code execution. One way to achieve this is to use a JavaScript interpreter rather than the built-in JavaScript eval() function.</p>
<p id="rfc.section.6.p.3">The issue of impersonation is a crucial aspect in UMA, particularly when entities are wielding bearer tokens that preclude proof-of-possession (of a secret or a cryptographic key). As such, one way to mitigate this risk is for the resource owner to require stronger claims to accompany any access request. For example, consider the case where Alice sets policies at the authorization server governing access to her resources by Bob. When Bob first seeks access and must obtain an RPT (for which the default RPT profile specifies a bearer token), Alice could set policies demanding that Bob prove his identity by providing a set of strong claims issued by a trusted attrribute provider in order to get authorization data associated with that token.</p>
<p id="rfc.section.6.p.4">Another issue concerns the use of the <a href="#OAuth2">[OAuth2]</a> implicit flow. In this case, Bob will have exposure to the token, and may maliciously pass the token to an unauthorized party. To mitigate this weakness and others, we recommend considering the following steps:</p>
<p/>

<ul>
  <li>Require that the Requesting Party (as defined in <a href="#UMA-obligations">[UMA-obligations]</a>) legitimately represent the wielder of the bearer token. This solution is based on a legal or contractual approach, and therefore does not reduce the risk from the technical perspective.</li>
  <li>The authorization server, possibly with input from the resource owner, can implement tighter time-to-live (TTL) strategies around the authorization data in RPTs. This is a classic approach with bearer tokens that helps to limit a malicious party's ability to intercept and use the bearer token. In the same vein, the authorization server could require claims to have a reasonable degree of freshness (which would require a custom claims profile).</li>
  <li>The strongest strategy is to disallow bearer-type RPTs within the UMA profile being deployed, by providing or requiring an RPT profile that requires use of a holder-of-key (HOK) approach. In this way, the wielder of the token must engage in a live session for proof-of-possession.</li>
</ul>
<p id="rfc.section.6.p.6">For information about the additional technical, operational, and legal elements of trust establishment between UMA entities and parties, which affects security considerations, see <a href="#UMA-obligations">[UMA-obligations]</a>.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> Privacy Considerations</h1>
<p id="rfc.section.7.p.1">The authorization server comes to be in possession of resource set information (such as names and icons) that may reveal information about the resource owner, which the authorization server's trust relationship with the resource server is assumed to accommodate. However, the client is a less-trusted party -- in fact, entirely untrustworthy until authorization data is associated with its RPT. This specification depends on <a href="#OAuth-resource-reg">[OAuth-resource-reg]</a>, which recommends obscuring resource set identifiers in order to avoid leaking personally identifiable information to clients through the scope mechanism.</p>
<p id="rfc.section.7.p.2">(More privacy considerations information to come.)</p>
<p id="rfc.section.7.p.3">For information about the technical, operational, and legal elements of trust establishment between UMA entities and parties, which affects privacy considerations, see <a href="#UMA-obligations">[UMA-obligations]</a>.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#conformance" id="conformance">Conformance</a></h1>
<p id="rfc.section.8.p.1">This section outlines conformance requirements for various entities implementing UMA endpoints.</p>
<p id="rfc.section.8.p.2">This specification has dependencies on other specifications, as referenced under the normative references listed in this specification. Its dependencies on some specifications, such as OpenID Connect (<a href="#OCStandard">[OCStandard]</a> and <a href="#OCMessages">[OCMessages]</a>), are optional depending on whether the feature in question is used in the implementation.</p>
<p id="rfc.section.8.p.3">The authorization server's configuration data provides a machine-readable method for it to indicate certain of the conformance options it has chosen or supports. Several of the configuration data properties allow for indicating extension features. Where this specification does not already require optional features to be documented, it is RECOMMENDED that authorization server developers and deployers document any profiled or extended features explicitly and use configuration data to indicate their usage. See <a href="#am-endpoints">Section 1.4</a> for information about providing and extending the configuration data.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.9.p.1">This document makes no request of IANA.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#Acknowledgments" id="Acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.10.p.1">The current editor of this specification is Thomas Hardjono of MIT. The following people are co-authors:</p>

<ul>
  <li>Paul C. Bryan, ForgeRock US, Inc. (former editor)</li>
  <li>Domenico Catalano, Oracle Corp.</li>
  <li>George Fletcher, AOL</li>
  <li>Maciej Machulak, Newcastle University</li>
  <li>Eve Maler, XMLgrrl.com</li>
  <li>Lukasz Moren, Newcastle University</li>
  <li>Christian Scholz, COMlounge GmbH (former editor)</li>
  <li>Jacek Szpot, Newcastle University</li>
</ul>
<p id="rfc.section.10.p.2">Additional contributors to this specification include the Kantara UMA Work Group participants, a list of whom can be found at <a href="#UMAnitarians">[UMAnitarians]</a>.</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> Issues</h1>
<p id="rfc.section.11.p.1">All issues are now captured at the project's GitHub site (<a href="https://github.com/xmlgrrl/UMA-Specifications/issues">https://github.com/xmlgrrl/UMA-Specifications/issues</a>).</p>
<h1 id="rfc.references"><a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="DynClientReg">[DynClientReg]</b>
      </td>
      <td class="top"><a title="IETF">Richer, J.</a>, "<a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-dyn-reg/">OAuth Dynamic Client Registration Protocol</a>", March 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OAuth-SAML">[OAuth-SAML]</b>
      </td>
      <td class="top"><a title="Campbell">Campbell, B.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-saml2-bearer">SAML 2.0 Bearer Assertion Profiles for OAuth 2.0</a>", March 2013.</td>
    </tr>
    <tr><td class="reference"><b id="OAuth-bearer">[OAuth-bearer]</b></td><td class="top"><a href="http://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>", October 2012.</td>, "</tr>
    <tr>
      <td class="reference">
        <b id="OAuth-introspection">[OAuth-introspection]</b>
      </td>
      <td class="top"><a>Richer, J.</a>, "<a href="http://tools.ietf.org/html/draft-richer-oauth-introspection">OAuth Token Introspection</a>", February 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OAuth-resource-reg">[OAuth-resource-reg]</b>
      </td>
      <td class="top"><a title="IETF">Hardjono, T.</a>, "<a href="https://tools.ietf.org/html/draft-hardjono-oauth-resource-reg">OAuth 2.0 Resource Set Registration</a>", December 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OAuth-threat">[OAuth-threat]</b>
      </td>
      <td class="top"><a>Lodderstedt, T.</a>, "<a href="http://tools.ietf.org/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>", January 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OAuth2">[OAuth2]</b>
      </td>
      <td class="top"><a title="IETF">Hardt, D.</a>, "<a href="http://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OCMessages">[OCMessages]</b>
      </td>
      <td class="top"><a>Sakimura, N.</a>, "<a href="http://openid.net/specs/openid-connect-messages-1_0.html">OpenID Connect Messages 1.0</a>", March 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OCStandard">[OCStandard]</b>
      </td>
      <td class="top"><a>Sakimura, N.</a>, "<a href="http://openid.net/specs/openid-connect-standard-1_0.html">OpenID Connect Standard 1.0</a>", March 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4627">[RFC4627]</b>
      </td>
      <td class="top"><a>Crockford, D.</a>, "<a href="http://tools.ietf.org/html/rfc4627">The application/json Media Type for JavaScript Object Notation (JSON)</a>", RFC 4627, July 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="UMA-obligations">[UMA-obligations]</b>
      </td>
      <td class="top"><a>Maler, E.</a>, "<a href="http://kantarainitiative.org/confluence/display/uma/UMA+Trust+Model">Binding Obligations on UMA Participants</a>", January 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="hostmeta">[hostmeta]</b>
      </td>
      <td class="top"><a title="Yahoo!">Hammer-Lahav, E.</a>, "<a href="http://tools.ietf.org/html/rfc6415">Web Host Metadata</a>", October 2011.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="OAuth-linktypes">[OAuth-linktypes]</b>
      </td>
      <td class="top"><a>Mills, W.</a>, "<a href="http://tools.ietf.org/html/draft-wmills-oauth-lrdd">Link Type Registrations for OAuth 2</a>", February 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OAuth-meta">[OAuth-meta]</b>
      </td>
      <td class="top"><a>Sakimura, N.</a>, "<a href="http://tools.ietf.org/html/draft-sakimura-oauth-meta">JSON Metadata for OAuth Responses</a>", February 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="UMA-casestudies">[UMA-casestudies]</b>
      </td>
      <td class="top"><a>Maler, E.</a>, "<a href="http://kantarainitiative.org/confluence/display/uma/Case+Studies">UMA Case Studies</a>", March 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="UMA-usecases">[UMA-usecases]</b>
      </td>
      <td class="top"><a title="Kantara">Maler, E.</a>, "<a href="http://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">UMA Scenarios and Use Cases</a>", October 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="UMAnitarians">[UMAnitarians]</b>
      </td>
      <td class="top"><a title="Maler">Maler, E.</a>, "<a href="http://kantarainitiative.org/confluence/display/uma/Participant+Roster">UMA Participant Roster</a>", April 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#History" id="History">Document History</a></h1>
<p id="rfc.section.A.p.1">NOTE: To be removed by RFC editor before publication as an RFC.</p>
<p id="rfc.section.A.p.2">See <a href="http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol">http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol</a> for a list of code-breaking and other major changes made to this specification at various revision points.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Thomas Hardjono</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Hardjono</span>
	  </span>
	</span>
	<span class="org vcardline">MIT</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hardjono@mit.edu">hardjono@mit.edu</a></span>

  </address>
</div>

</body>
</html>
